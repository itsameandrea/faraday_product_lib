const initFaradayEcommerce=async(productId=null)=>{let index=0;let form=document.querySelectorAll("form")[index];while(!form.classList.value.includes("product")){index+=1;form=document.querySelectorAll("form")[index]}console.log("Form: ",form);let addToCardButton=form?form.querySelector('button[type="submit"]'):null;console.log("Button: ",addToCardButton);if(!form||!button){console.log("Your theme is not compatible by default with Faraday e-commerce. Don't worry. You can still manually configure the theme as shown in the documentation.");return}const product=productId||addToCardButton.dataset.productId||null;let email="";let subscriberId="";let status="visitor";let is_dwell=false;let div,paragraph,input,submitButton;const checkIfEnabled=async()=>{const res=await fetch(`/apps/proxy/products/${product}/faraday_enabled`);return await res.json()};const replaceFormContent=async()=>{form.innerHTML=`<button id="faraday-submit-button" class="${addToCardButton.classList.value}"> Add To Cart </button>`;button=document.querySelector("#faraday-submit-button")};const timeUserSession=()=>{let count=0;const timer=setInterval(()=>{if(count>5){clearInterval(timer);return}if(count===5){is_dwell=true;updateSubscriber()}count+=1;return},1e3)};const createSubscriber=async()=>{const response=await fetch("/apps/proxy/subscribers",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({email:email,status:status,is_dwell:is_dwell,product_id:product})});return await response.json()};const updateSubscriber=async()=>{await fetch(`/apps/proxy/subscribers/${subscriberId}`,{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify({email:email,status:status,is_dwell:is_dwell})})};if(product){const{is_enabled:is_enabled}=await checkIfEnabled();if(is_enabled){replaceFormContent();const{id:id}=await createSubscriber();subscriberId=id;timeUserSession();document.addEventListener("click",async e=>{e.preventDefault();e.stopPropagation();if(e.target&&e.target.id==="faraday-submit-button"){status="active";updateSubscriber();div=document.createElement("div");input=document.createElement("input");submitButton=document.createElement("button");paragraph=document.createElement("p");paragraph.innerText="Sorry, we are currently out of stock of this item please signup to be notified when it comes back into stock";input.type="email";input.placeholder="your@email.com";input.id="faraday-email-input";input.style.width="100%";input.style.marginBottom="10px";submitButton.innerText="Subscribe";submitButton.classList.add(...Array.from(addToCardButton.classList));submitButton.id="faraday-submit-btn";div.appendChild(paragraph);div.appendChild(input);div.appendChild(submitButton);addToCardButton.replaceWith(div)}});document.addEventListener("click",async e=>{e.preventDefault();if(e.target&&e.target.id==="faraday-submit-btn"){email=input.value;status="subscriber";await updateSubscriber();input.value="";submitButton.innerText="Thanks! We'll keep you posted";submitButton.disabled=true}})}}};try{const productId=meta.product.id;initFaradayEcommerce(productId)}catch(error){console.log("Your theme may not compatible by default with Faraday e-commerce. Don't worry. You can still manually configure the theme as shown in the documentation.");initFaradayEcommerce()}